<!DOCTYPE html>
<html>
  <head>
    <title>ActiveSound</title>
    <%= favicon_link_tag "ActiveSound.png", rel: "icon", type: "image/png" %>
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartkick"></script>
    <%= stylesheet_link_tag "application", "data-turbo-track": "reload" %>
    <%= javascript_include_tag "application", "data-turbo-track": "reload", defer: true %>
    
    <style>
      :root { --app-bg-url: url('<%= asset_path "ActiveSound.png" %>'); }
    </style>
  </head>
  <body class="text-light custom-bg">
    <div class="app-overlay">
      <% mostrar_nav = !(usuario_signed_in? && session[:require_password_change] == true && controller_name == "usuarios" && action_name == "edit" && current_usuario.id == @usuario&.id) %>
      <% if mostrar_nav %>
        <nav class="navbar navbar-expand-lg navbar-dark bg-black mb-4 py-3">
          <div class="container-fluid">
            <a class="navbar-brand d-flex align-items-center" href="<%= root_path %>">
              <%= image_tag "ActiveSound.png", alt: "ActiveSound", height: "48", width: "50", class: "me-2" %>
              <span class="fw-bold">ActiveSound</span>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarContent" aria-controls="navbarContent" aria-expanded="false" aria-label="Toggle navigation">
              <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse" id="navbarContent">
              <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                <li class="nav-item mx-1">
                  <%= link_to storefront_productos_path, class: "nav-link" do %>
                    <i class="bi bi-shop fs-5"></i> <span class="d-none d-lg-inline">StoreFront</span>
                  <% end %>
                </li>
                
                <% if usuario_signed_in? %>
                  <li class="nav-item mx-1">
                    <%= link_to productos_path, class: "nav-link" do %>
                      <i class="bi bi-box-seam fs-5"></i> <span class="d-none d-lg-inline">Productos</span>
                    <% end %>
                  </li>
                  <% unless current_usuario.empleado? %>
                    <li class="nav-item mx-1">
                      <%= link_to usuarios_path, class: "nav-link" do %>
                        <i class="bi bi-people fs-5"></i> <span class="d-none d-lg-inline">Usuarios</span>
                      <% end %>
                    </li>
                  <% end %>
                  <li class="nav-item mx-1">
                    <%= link_to ventas_path, class: "nav-link" do %>
                      <i class="bi bi-cart-check fs-5"></i> <span class="d-none d-lg-inline">Ventas</span>
                    <% end %>
                  </li>
                  <li class="nav-item mx-1">
                    <%= link_to admin_dashboard_path, class: "nav-link" do %>
                      <i class="bi bi-speedometer2 fs-5"></i> <span class="d-none d-lg-inline">Reportes</span>
                    <% end %>
                  </li>
                <% end %>
              </ul>

              <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
                <% if usuario_signed_in? %>
                  <li class="nav-item dropdown mx-1">
                    <a class="nav-link dropdown-toggle d-flex align-items-center" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                      <i class="bi bi-person-circle fs-4 me-1"></i>
                      <span class="d-none d-lg-inline"><%= current_usuario.nombre %></span>
                    </a>
                    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="navbarDropdown">
                      <li><%= link_to usuario_path(current_usuario), class: "dropdown-item" do %>
                        <i class="bi bi-person-lines-fill"></i> Perfil
                      <% end %></li>
                      <li><hr class="dropdown-divider"></li>
                      <li>
                        <%= button_to destroy_usuario_session_path, method: :delete, class: "dropdown-item" do %>
                          <i class="bi bi-box-arrow-right"></i> Cerrar sesión
                        <% end %>
                      </li>
                    </ul>
                  </li>
                <% else %>
                  <li class="nav-item mx-1">
                    <%= link_to new_usuario_session_path, class: "nav-link" do %>
                      <i class="bi bi-box-arrow-in-right fs-5"></i> <span class="d-none d-lg-inline">Iniciar sesión</span>
                    <% end %>
                  </li>
                <% end %>
              </ul>
            </div>
          </div>
        </nav>
      <% end %>

      <div class="container flash-wrapper">
        <% shown = [] %>
        <% flash.each do |key, value| %>
          <% next if value.blank? %>
          <% next if shown.include?(value.to_s) %>
          <% shown << value.to_s %>
          <% css = case key.to_s
              when "notice", "success" then "flash-success"
              when "alert", "error"    then "flash-danger"
              else "flash-success"
              end %>
          <div class="flash-message <%= css %> mb-2">
            <%= value %>
          </div>
        <% end %>
        <% flash.clear %>
      </div>

      <main class="container my-4">
        <div class="main-card">
          <%= yield %>
        </div>
      </main>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
  </body>
</html>
<%= form_with(model: producto, class: "row g-3") do |form| %>
  <% if producto.errors.any? %>
    <div class="alert alert-danger">
      <h2><%= pluralize(producto.errors.count, "error") %> impidieron guardar el producto:</h2>
      <ul>
        <% producto.errors.each do |error| %>
          <li><%= error.full_message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div class="col-12">
    <%= form.label :titulo, "Título", class: "form-label" %>
    <%= form.text_field :titulo, class: "form-control" %>
  </div>

  <div class="col-12">
    <%= form.label :descripcion, "Descripción", class: "form-label" %>
    <%= form.text_area :descripcion, class: "form-control" %>
  </div>

  <div class="col-12">
    <%= form.label :autor, "Autor", class: "form-label" %>
    <%= form.text_field :autor, class: "form-control" %>
  </div>

  <div class="col-6">
    <%= form.label :precio, "Precio", class: "form-label" %>
    <%= form.number_field :precio, step: 0.01, class: "form-control" %>
  </div>

  <div class="col-6">
    <%= form.label :stock, "Stock", class: "form-label" %>
    <%= form.number_field :stock, class: "form-control" %>
  </div>

  <div class="col-6">
    <%= form.label :categoria, "Género musical", class: "form-label" %>
    <%= form.select :categoria,
          [
            ["Rock", "rock"],
            ["Pop", "pop"],
            ["Jazz", "jazz"],
            ["Blues", "blues"],
            ["Clásica", "clasica"],
            ["Reggae", "reggae"],
            ["Hip-Hop", "hiphop"],
            ["Metal", "metal"],
            ["Electrónica", "electronica"]
          ],
          {}, class: "form-control" %>
  </div>

  <div class="col-6">
    <%= form.label :tipo, "Tipo", class: "form-label" %>
    <%= form.select :tipo,
          [["Vinilo", "vinilo"], ["CD", "cd"]],
          {}, class: "form-control" %>
  </div>

  <div class="col-6">
    <%= form.label :estado_fisico, "Estado del producto", class: "form-label" %>
    <%= form.select :estado_fisico,
          [["Nuevo", "nuevo"], ["Usado", "usado"]],
          {}, class: "form-control", id: "estado_fisico_select" %>
  </div>

  <div class="col-12">
    <%= form.label :imagenes, "Imágenes", class: "form-label" %>
    <%= form.file_field :imagenes, multiple: true, accept: "image/*", class: "form-control" %>
  </div>

  <div class="col-12" id="audio-muestra-field" style="<%= producto.estado_fisico == "usado" ? "" : "display:none;" %>">
    <%= form.label :audio_muestra, "Audio de muestra", class: "form-label" %>
    <%= form.file_field :audio_muestra, accept: "audio/*", class: "form-control" %>
  </div>

  <div class="col-12 mt-3">
    <%= form.submit "Guardar", class: "btn btn-as-dark" %>
  </div>
<% end %>

<script>
  document.addEventListener("DOMContentLoaded", function() {
    var estadoSelect = document.getElementById("estado_fisico_select");
    var audioField = document.getElementById("audio-muestra-field");
    if (estadoSelect) {
      estadoSelect.addEventListener("change", function() {
        if (estadoSelect.value === "usado") {
          audioField.style.display = "";
        } else {
          audioField.style.display = "none";
        }
      });
    }
  });
</script>
<div class="renglon-venta" style="display:flex; gap:12px; align-items:center; border-bottom:1px solid #eee; padding:10px 0;">
  <%= df.hidden_field :_destroy, value: 0, class: "destroy-flag" %>

  <div style="flex: 2;">
    <% if df.object.persisted? %>
      <%= df.hidden_field :producto_id, value: df.object.producto_id %>
      <div class="producto-fijo"><%= df.object.producto&.titulo || "Producto eliminado" %></div>
    <% else %>
      <%= df.hidden_field :producto_id, class: "producto-id-field" %>
      <input type="text" 
             class="form-control producto-autocomplete" 
             placeholder="Buscar producto por título..."
             data-detalle-index="<%= df.index %>"
             autocomplete="off">
      <div class="producto-info text-muted small mt-1"></div>
    <% end %>
  </div>

  <div style="width:110px;">
    <% if df.object.persisted? %>
      <%# enviar cantidad aunque se muestre como texto; añadir clase para que JS la use %>
      <%= df.hidden_field :cantidad, value: df.object.cantidad, class: "cantidad-input d-none" %>
      <div class="cantidad-fija text-center"><%= df.object.cantidad %></div>
    <% else %>
      <%= df.number_field :cantidad, min: 1, value: (df.object.cantidad || 1),
              class: "form-control cantidad-input" %>
    <% end %>
  </div>

  <div style="width:140px;">
    <% if df.object.persisted? %>
      <%# mostrar precio como texto y enviar hidden con clase para que JS lo lea %>
      <div class="precio-fijo text-end">$<%= number_with_precision(df.object.precio.to_f, precision: 2) %></div>
      <%= df.hidden_field :precio, value: df.object.precio, class: "precio-input d-none" %>
    <% else %>
      <%= df.number_field :precio, step: "0.01",
              class: "form-control precio-input", value: (df.object.precio || "") %>
    <% end %>
  </div>

  <div style="width:140px;">
    <label class="form-label">Subtotal</label>
    <input type="text" readonly class="form-control subtotal-input" value="<%= number_with_precision((df.object.cantidad || 0) * (df.object.precio || 0), precision: 2) %>">
  </div>

  <div style="width:90px; display:flex; align-items:flex-end;">
    <%# no mostrar botón eliminar para renglones persistidos; solo nuevos tienen botón (ya hecho) %>
    <% unless df.object.persisted? %>
      <button type="button" class="btn btn-danger eliminar-renglon">Eliminar</button>
    <% end %>
  </div>
</div>
